# Юридический сервис "Защита Отцов" - Документация

## Обзор проекта
Проект представляет собой веб-приложение для анализа юридических документов и автоматического формирования жалоб в государственные органы. Основные технологии:
- **Frontend**: Vue 3 (Composition API), Pinia, Vue Router, Vite
- **Backend**: Node.js (v24.5.0)
- **AI**: Локальная LLM модель (llama3.1:latest) через Ollama

## Основные функциональные блоки

### 1. Загрузка и анализ документов
- Загрузка PDF/TXT документов пользователем
- Извлечение текста из документов
- Анализ текста локальной LLM моделью
- Сохранение структурированных данных в `db.json`

### 2. Формирование жалоб
- Анализ юридических нарушений в документах
- Генерация жалоб в выбранные ведомства
- Сохранение жалоб с привязкой к исходным документам

### 3. Управление документами
- Просмотр списка документов
- Детальный просмотр и редактирование
- Удаление документов

### 4. Управление жалобами
- Просмотр списка сгенерированных жалоб
- Экспорт жалоб в TXT/DOC форматах
- Удаление жалоб

## Архитектура проекта

### Фронтенд структура

#### Главные компоненты:
- `App.vue` - Корневой компонент с навигацией
- `views/` - Страницы приложения:
  - `HomeView.vue` - Главная страница загрузки документов
  - `DocumentReview.vue` - Предпросмотр и редактирование документа
  - `DocumentsList.vue` - Список всех документов
  - `ComplaintForm.vue` - Форма генерации жалобы
  - `ComplaintsList.vue` - Список сгенерированных жалоб
  - `DocumentDetail.vue` - Детали документа

#### Хранилища (Pinia):
- `documentStore.js` - Управление документами
- `complaintStore.js` - Управление жалобами
- `aiStore.js` - Взаимодействие с AI моделью

#### Вспомогательные компоненты:
- `FileUpload.vue` - Компонент загрузки файлов
- `NotificationToast.vue` - Уведомления

### Бекенд структура

#### Основные модули:
- `services/aiService.js` - Основной сервис работы с AI моделью
- `services/pdfService.js` - Извлечение текста из PDF
- `routes/documentRoutes.js` - API для работы с документами
- `routes/complaintRoutes.js` - API для работы с жалобами

#### Модели:
- `models/Document.js` - Модель документа
- `models/Complaint.js` - Модель жалобы

## Детальное описание ключевых файлов

### Frontend

#### Хранилища (Pinia)

**documentStore.js**:
- Управление состоянием документов
- Методы:
  - `fetchDocuments()` - Загрузка списка документов
  - `uploadFiles()` - Загрузка файлов
  - `analyzeDocument()` - Анализ документа через AI
  - `saveDocument()` - Сохранение документа

**complaintStore.js**:
- Управление состоянием жалоб
- Методы:
  - `generateComplaint()` - Генерация жалобы
  - `exportComplaint()` - Экспорт жалобы
  - `fetchComplaints()` - Загрузка списка жалоб

**aiStore.js**:
- Взаимодействие с локальной LLM
- Методы:
  - `generateSummary()` - Генерация краткой сводки
  - `detectViolations()` - Поиск юридических нарушений
  - `analyzeAttachment()` - Анализ вложений

#### Компоненты

**HomeView.vue**:
- Главная страница загрузки документов
- Использует `FileUpload.vue` для загрузки файлов
- Передает данные в `documentStore`

**DocumentReview.vue**:
- Предпросмотр документа перед сохранением
- Редактирование полей документа
- Кнопка анализа документа

**DocumentsList.vue**:
- Отображение списка документов
- Кнопки:
  - Анализировать документ
  - Удалить документ
  - Сформировать жалобу

**ComplaintForm.vue**:
- Форма генерации жалобы
- Выбор ведомства
- Просмотр сгенерированной жалобы

**ComplaintsList.vue**:
- Список сгенерированных жалоб
- Кнопки экспорта в TXT/DOC

### Backend

**aiService.js**:
- Основной класс `AIService` для работы с моделью
- Методы:
  - `analyzeLegalText()` - Анализ юридического текста
  - `generateComplaintV2()` - Генерация жалобы (версия 2)
  - `analyzeAttachment()` - Анализ вложений

**documentRoutes.js**:
- API endpoints:
  - `POST /upload` - Загрузка документов
  - `POST /analyze` - Анализ документа
  - `GET /` - Получение списка документов
  - `POST /complaints` - Создание жалобы для документа

**complaintRoutes.js**:
- API endpoints:
  - `POST /generate` - Генерация жалобы
  - `GET /export` - Экспорт жалобы
  - `GET /` - Получение списка жалоб

## Пайплайн обработки документа

1. Пользователь загружает документ через `HomeView.vue`
2. Файл передается в `documentStore.uploadFiles()`
3. Для PDF вызывается `pdfService.extractTextFromPdf()`
4. Текст анализируется через `aiStore.analyzeDocument()`
5. Результаты сохраняются в `db.json` через API
6. Пользователь просматривает и редактирует документ в `DocumentReview.vue`
7. При необходимости генерируется жалоба через `complaintStore.generateComplaint()`
8. Жалоба сохраняется и может быть экспортирована

## Структура db.json

```json
{
  "documents": [
    {
      "id": "uuid",
      "dateReceived": "YYYY-MM-DD",
      "agency": "Ведомство",
      "originalText": "Текст документа",
      "summary": "Краткая суть",
      "keyParagraphs": ["Цитата 1", "Цитата 2"],
      "documentDate": "Дата документа",
      "senderAgency": "Ведомство-отправитель",
      "attachments": [
        {
          "name": "filename.pdf",
          "text": "Текст вложения",
          "analysis": { ... }
        }
      ],
      "complaints": ["complaint_id1", "complaint_id2"]
    }
  ],
  "complaints": [
    {
      "id": "uuid",
      "documentId": "document_id",
      "agency": "Ведомство для жалобы",
      "content": "Текст жалобы",
      "createdAt": "timestamp"
    }
  ]
}```
Взаимодействие компонентов
text
[HomeView] → [documentStore] → [Backend API]
                     ↓
[DocumentReview] ← [db.json]
                     ↓
[DocumentsList] → [ComplaintForm] → [complaintStore] → [Backend API]
                     ↓
            [ComplaintsList] ← [db.json]
Особенности реализации
Работа с файлами:

Поддержка PDF и TXT форматов

Ограничение на размер файлов

Извлечение текста на бекенде

AI интеграция:

Локальная модель через Ollama

Кеширование запросов

Обработка ошибок соединения

Безопасность:

Валидация входных данных

Обработка ошибок на всех уровнях

Защита от перегрузки модели

Производительность:

Оптимизированные запросы к модели

Ленивая загрузка компонентов

Кеширование результатов анализа