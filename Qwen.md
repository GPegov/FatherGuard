# Юридический сервис "Защита Отцов" - Документация

Привет! Я пишу код проекта на Vue3. 
Имеющийся функционал не урезай! Осторожно убирай только дублирующие функции. Выстраивай чёткую логику приложения. 
Мы с тобой создаём приложение на Vue3 Composition API, используем Vite, Pinia и Vue Router а бекенд у нас на Node.js v24.5.0. Python я использовать не умею. Помоги мне в дальнейшей разработке.
Вся логика и функционал должны быть в Pinia Store, а в компонентах только отображение! ЭТО ОЧЕНЬ ВАЖНО!
Моё железо: Xeon E5 2640v4, 64Gb ddr4 Quad channel Ram.
Я использую Windows 10.
Я также локально скачал модель llama3.1:latest для использования её функционала в приложении. 
Отвечай мне на русском.
Если тебе нужно ознакомится с другими файлами из моего проекта - попроси и я их пришлю.
У приложения есть функция загрузки PDF-файлов и распознавания в них текста. Далее распознанный текст передаётся для анализа в локальную LLM через ollama и в нём выделяется краткая суть и существенные параграфы. Всей этой информацией пополняется файл db.json и в его структуре должны быть следующие поля: 

1) дата поступления

2) дословный текст, предоставленный пользователем 

3) ведомство на которое будет формироваться жалоба

4) краткая суть текста пользователя(не дословно)

5) дословно скопированные существенные параграфы (дословно - это очень важно для последующего составления жалоб)

6) расшифровка предоставленных им документов:

  а) Дата отправления документа

  б) Ведомство, отправившее документ

  в) краткая суть документа

  г) Полный текст документа

  д) Дословно скопированные существенные параграфы из расшифровки документа (дословно - это очень важно для последующего составления жалоб).

После загрузки текста пользователя, вложенных документов и нажатия кнопки "Продолжить" на главной странице, открывается страница предпросмотра документа перед его сохранением с возможностью ручного редактирования (DocumentReview.vue). Ниже следует добавить возможно недостающие поля из новой структуры базы данных db.json, чтобы вся информация из текущей карточки отображалась в этом компоненте.

Третья страница - отображение списком всех актов записей из файла db.json в виде поля даты формирования, ведомства, на которое будет сформирована жалоба и краткой сути текста пользователя.   

В правой части каждой записи есть кнопка "Сформировать жалобу".

После нажатия кнопки "Сформировать жалобу" локальная модель анализирует выбранный слот базы данных, а также остальные слоты db.json, поступившие ранее данного слота на предмет наличия сведений, существенных для составления жалобы на основе этого входящего документа,  и предлагает на выбор ведомства, в которые пользователь имеет право направить жалобу на ведомство, допустившее нарушение: 

- ФССП,

- Прокуратура',

- Суд (административное исковое заявление)

- Уполномоченный по правам человека (омбудсмен).  

После выбора ведомства для направления жалобы, нейросеть формирует жалобу и сохраняет её в файл db.json по аналогии с методом сохранения входящих документов, только в сформированных жалобах добавляется поле, в ответ на какой из входящих документ сформирована эта жалоба.

Четвёртая страница - список сформированных жалоб, по аналогии с третьей страницей, но без кнопки анализировать. При клике  Напротив каждой сформированной жалобы должна быть кнопка "Экспорт" с возможностью сохранения выбранной жалобы в формате .txt или .doc.

Механика удаления входящих документов и сформированных жалоб уже сформирована - её менять не нужно, без моей прямой просьбы.




## Обзор проекта
Проект представляет собой веб-приложение для анализа юридических документов и автоматического формирования жалоб в государственные органы. Основные технологии:
- **Frontend**: Vue 3 (Composition API), Pinia, Vue Router, Vite
- **Backend**: Node.js (v24.5.0)
- **AI**: Локальная LLM модель (llama3.1:latest) через Ollama

## Основные функциональные блоки

### 1. Загрузка и анализ документов
- Загрузка PDF/TXT документов пользователем
- Извлечение текста из документов
- Анализ текста локальной LLM моделью
- Сохранение структурированных данных в `db.json`

### 2. Формирование жалоб
- Анализ юридических нарушений в документах
- Генерация жалоб в выбранные ведомства
- Сохранение жалоб с привязкой к исходным документам

### 3. Управление документами
- Просмотр списка документов
- Детальный просмотр и редактирование
- Удаление документов

### 4. Управление жалобами
- Просмотр списка сгенерированных жалоб
- Экспорт жалоб в TXT/DOC форматах
- Удаление жалоб

## Архитектура проекта

### Фронтенд структура

#### Главные компоненты:
- `App.vue` - Корневой компонент с навигацией
- `views/` - Страницы приложения:
  - `HomeView.vue` - Главная страница загрузки документов
  - `DocumentReview.vue` - Предпросмотр и редактирование документа
  - `DocumentsList.vue` - Список всех документов
  - `ComplaintForm.vue` - Форма генерации жалобы
  - `ComplaintsList.vue` - Список сгенерированных жалоб
  - `DocumentDetail.vue` - Детали документа

#### Хранилища (Pinia):
- `documentStore.js` - Управление документами
- `complaintStore.js` - Управление жалобами
- `aiStore.js` - Взаимодействие с AI моделью

#### Вспомогательные компоненты:
- `FileUpload.vue` - Компонент загрузки файлов
- `NotificationToast.vue` - Уведомления

### Бекенд структура

#### Основные модули:
- `services/aiService.js` - Основной сервис работы с AI моделью
- `services/pdfService.js` - Извлечение текста из PDF
- `routes/documentRoutes.js` - API для работы с документами
- `routes/complaintRoutes.js` - API для работы с жалобами

#### Модели:
- `models/Document.js` - Модель документа
- `models/Complaint.js` - Модель жалобы

## Детальное описание ключевых файлов

### Frontend

#### Хранилища (Pinia)

**documentStore.js**:
- Управление состоянием документов
- Методы:
  - `fetchDocuments()` - Загрузка списка документов
  - `uploadFiles()` - Загрузка файлов
  - `analyzeDocument()` - Анализ документа через AI
  - `saveDocument()` - Сохранение документа

**complaintStore.js**:
- Управление состоянием жалоб
- Методы:
  - `generateComplaint()` - Генерация жалобы
  - `exportComplaint()` - Экспорт жалобы
  - `fetchComplaints()` - Загрузка списка жалоб

**aiStore.js**:
- Взаимодействие с локальной LLM
- Методы:
  - `generateSummary()` - Генерация краткой сводки
  - `detectViolations()` - Поиск юридических нарушений
  - `analyzeAttachment()` - Анализ вложений

#### Компоненты

**HomeView.vue**:
- Главная страница загрузки документов
- Использует `FileUpload.vue` для загрузки файлов
- Передает данные в `documentStore`

**DocumentReview.vue**:
- Предпросмотр документа перед сохранением
- Редактирование полей документа
- Кнопка анализа документа

**DocumentsList.vue**:
- Отображение списка документов
- Кнопки:
  - Анализировать документ
  - Удалить документ
  - Сформировать жалобу

**ComplaintForm.vue**:
- Форма генерации жалобы
- Выбор ведомства
- Просмотр сгенерированной жалобы

**ComplaintsList.vue**:
- Список сгенерированных жалоб
- Кнопки экспорта в TXT/DOC

### Backend

**aiService.js**:
- Основной класс `AIService` для работы с моделью
- Методы:
  - `analyzeLegalText()` - Анализ юридического текста
  - `generateComplaintV2()` - Генерация жалобы (версия 2)
  - `analyzeAttachment()` - Анализ вложений

**documentRoutes.js**:
- API endpoints:
  - `POST /upload` - Загрузка документов
  - `POST /analyze` - Анализ документа
  - `GET /` - Получение списка документов
  - `POST /complaints` - Создание жалобы для документа

**complaintRoutes.js**:
- API endpoints:
  - `POST /generate` - Генерация жалобы
  - `GET /export` - Экспорт жалобы
  - `GET /` - Получение списка жалоб

## Пайплайн обработки документа

1. Пользователь загружает документ через `HomeView.vue`
2. Файл передается в `documentStore.uploadFiles()`
3. Для PDF вызывается `pdfService.extractTextFromPdf()`
4. Текст анализируется через `aiStore.analyzeDocument()`
5. Результаты сохраняются в `db.json` через API
6. Пользователь просматривает и редактирует документ в `DocumentReview.vue`
7. При необходимости генерируется жалоба через `complaintStore.generateComplaint()`
8. Жалоба сохраняется и может быть экспортирована

## Структура db.json

```json
{
  "documents": [
    {
      "id": "uuid",
      "dateReceived": "YYYY-MM-DD",
      "agency": "Ведомство",
      "originalText": "Текст документа",
      "summary": "Краткая суть",
      "keyParagraphs": ["Цитата 1", "Цитата 2"],
      "documentDate": "Дата документа",
      "senderAgency": "Ведомство-отправитель",
      "attachments": [
        {
          "name": "filename.pdf",
          "text": "Текст вложения",
          "analysis": { ... }
        }
      ],
      "complaints": ["complaint_id1", "complaint_id2"]
    }
  ],
  "complaints": [
    {
      "id": "uuid",
      "documentId": "document_id",
      "agency": "Ведомство для жалобы",
      "content": "Текст жалобы",
      "createdAt": "timestamp"
    }
  ]
}```
Взаимодействие компонентов
text
[HomeView] → [documentStore] → [Backend API]
                     ↓
[DocumentReview] ← [db.json]
                     ↓
[DocumentsList] → [ComplaintForm] → [complaintStore] → [Backend API]
                     ↓
            [ComplaintsList] ← [db.json]
Особенности реализации
Работа с файлами:

Поддержка PDF и TXT форматов

Ограничение на размер файлов

Извлечение текста на бекенде

AI интеграция:

Локальная модель через Ollama

Кеширование запросов

Обработка ошибок соединения

Безопасность:

Валидация входных данных

Обработка ошибок на всех уровнях

Защита от перегрузки модели

Производительность:

Оптимизированные запросы к модели

Ленивая загрузка компонентов

Кеширование результатов анализа